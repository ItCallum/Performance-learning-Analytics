---
title: "CSC8631 202021 Report"
author: "Callum Matthew Simpson - b6030326"
output:
  pdf_document: default
  word_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
# Knitr setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
```


```{r include=FALSE}
# Load project

library('ProjectTemplate')
load.project()

source("src/SC_for_merged_analysis.R")
source("src/SC_for_leaver_analysis.R")
source("src/SC_for_clean_enroled.R")
source("src/SC_for_clean_leaving_data.R")

```

The following is my report of my analysis CSC8631 - Data Management and Exploratory Data Analysis course work. It will discuss my analysis and how I did it using the Crisp-DM model.

## Business understanding
As the first step in the Crisp-DM model is business understanding I first looked into the task that I had been given and who gave it was for.

### The Client background 
The cilent for this report will be Newcastle University who is using the site FutureLearn to host a course on Cyber Security: Safety at Home, Online, in Life. FutureLearn is an online training provider offering a wide selection of courses, often delivered in association with big-name colleges. Newcastle University is a UK public research university based in Newcastle upon Tyne

### The objective 
Newcastle university has gathered information about the users that have attended this course and are wanting to perform learning Analytics on this data to get insight into student engagement.

Learning Analytics is a rapidly-growing application area for Data Science, defined as “the measurement, collection, analysis and reporting of data about learners and their contexts, for purposes of understanding and optimizing learning and the environment in which it occurs”

As there is no formal requirement on the question that the university wants to be investigated I decided that I wanted to get a better understanding of why a user leaves the course. I feel like this would be a good measure of engagement as I could potentially find common reason and trends that are causing to leave the course meaning my findings could help improve the course to keep users engaged and lower the amount of people that leave the course. 

Because of this my business object will be "give useful insights into why people decide to leave the course"

### Assess situation 
I have been given data about the users who have attended the course, like enrollment data and answers to activity question. The data is split across seven run of the course (so each run has it own set of user data).  

### Determine data mining goals
As i am want to look into useful insights into why people decide to leave the course a clear data mining goal will be finding out the common reason a person leaves so that the course be updated to help reduce people leaving in the next cycle. Similarly another goal of mine should be be finding out who is leaving as again it means that measure could be put in check to increase engagement in that group. My success criteria will be data that clearly allows us to see why people are leaving. 

### Project plan
My aim is to 

- understand data by the 17th of November
- have the first clean bit of data by the 22nd of November 
- Have roughly two weeks to do my analysis 
- get my analysis done by the 1st of December.  

I am planning to use and R project with a project template to ensure that my code can be reproducible.

## Data understanding
### The Collect initial data 
The data I have been given is a set of different datasets relating to a different factor of the course. We have 7 of these "set" as we information about 7 runs of this course. New modifed data based off / using this data will be created automatically by my project template. I will say when its relevant when this has been done. 

### Description of all data  
The following will go over all the data collected and briefly outlies what is stored in each dataset.

#### Archetype survey responses
Only data for cycle 3 to 7 seems to be recorded. It a collection of the archetypes of the users with 4 columns.

+ id <int> - user id for cycle
+ learner_id <chr> - user id 
+ responded_at <chr> - the time a user responded
+ archetype <chr> - what Archetype they define themselves as

#### Cyber security enrolments
For all cycles,The enrollment data for each user. Contains 13 rows. Note worth rows are

+ id <int> - user id for cycle
+ learner_id <chr> - user id 
+ role <chr> - role of the person one the course 
+ gender <chr> - User identifed gender
+ country <chr> - give users country
+ age <chr> - ages done in age range brackets
+ highest education <chr> - Highest education.
+ It also contianes if they are employed and where 

#### cyber leaving results
Only for cycles 4 to 7. The reason people left and when about in the course they left.

+ id <int> - user id for cycle
+ learner_id <chr> - user id 

+ left_at <chr> - time and date when a user left the course
+ leaving_reason <chr> - the reason why the user left given from a set selection of given options
+ last_completed_step_at <chr> - time and date of the users last step
+ last_completed_step <dbl> - what was the users last step
+ last_completed_week_number <int> - what was the last week a user got to 
+ last_completed_step_number <int> - what was the users last step the completed


#### question response
For all cycles. The responses for the questions given throughout the course.

+ learner_id <chr> - user id 
+ quiz_question <chr> - the full question numner
+ question_type <chr> - the type of question
+ week_number <int> - the week number the question appread
+ step_number <int> - the step the question apperead
+ question_number <int> - the question sub number
+ response <chr> - users answers
+ cloze_response <lgl> - answer approximated
+ submitted_at <chr> - The time a user submitted the question
+ correct <chr> - Was the user correct.

#### Step activity
For all cycles. When a user started and finished that step

+ learner_id <chr> - user id 
+ step <dbl> - week + step number
+ week_number <int> - the week number
+ step_number <int> - the step number
+ first_visited_at <chr> - When the user first visited the step
+ last_completed_at <chr> - when the user finished the step

#### Team members
only in cycles 2 to 7. Contians information about peoples rows.


+ id <chr> - users id
+ first_name <chr> - users first name
+ last_name <chr> - users last name
+ team_role <chr> - team role is the role whole of the person in the team
+ user_role <chr> - user role seems to be role of what the user 

#### weekly_sentiment_survey_responses
Seems to be only cycles 6 and 7. A brief survay about how people are finding the course

+ id <int> - user ID
+ responded_at <chr> - the time the user responded.
+ week_number <int> - the week 
+ experience_rating <int> - out of 5 how did the user rate the week
+ reason <chr> - a comment on their opinion

#### video_stats
For all cycles. Information about the videos. There are 23 columns so instead of listing everything out this data set contianes

+ how long people are watching a video
+ where they are watching it 
+ what people are watching it on


### Overview
As you can see we have alot of data at hand to help us answer the question. Each dataset has an ID function so that can be our meta data that can be used to link all the dataset together. Exploring the dataset its clear that not all cycles contain the same recorded data as others. This has lead me to make my first assumption.

## Assumption One
Not all data was recorded in each cycle as some cycles contain empty datafile. I am assuming that this is because as the cycles went on new aspects user interaction where recorded.

## Choosing the right data
After doing a scan over all the data I decided on what I was going to use. As i decided to look into why user left the course and obvious start would be by looking at the the courses leaving results to see what users where saying.

As I had 4 datasets to work with (cycles 4 to 7) I merged them together but made sure that i included an new column called Cycle <dbl> which contains the cycle number that that row of data came from. This made a dataframe of `r nrow(combine_Leaving)` rows.


The next two sections on exploring data and verify data quality will be on this dataset.

## ExploreData
### ID variables 
As I merged 4 datasets together i wanted to make sure that there wast any weird duplicates or any in cycle duplication for our 2 variables are relating id.

```{r ID_Var_dups}

table_dup_ID

table_dup_Learner_ID

```

We see that id has no duplicates but learner_id did contain some duplicate ids.

From a check for duplicates we find that for the most part are the same learner id but in a different cycle suggesting that we have a few people who are leaving deciding to leave one cycle but rejoining another cycle only to leave again later. This is fine as its same user different cycles and not same user same cycle.

If we look at duplaices of learner_id and cycle we find `r nrow(dup_learner_id_and_cycle)` occurrences. For the most part we find alot of these duplicates are within a few minuets of each other, However some of these dates are days out. 

To be safe I decided to remove all these duplicate values leaving us with `r nrow(removed_duplicate_df)` rows to work with.

### How many people left each cycle 
Next I wanted to see how many people left each cycle so i decided to make a barplot to check the counts.

```{r how_many_people_left_cycle}

bar_chart_of_user_per_cycle

```
As there is no NA coloum we can safely ensure that every row has be assigned to a cycle.

As we can see there was almost double the amount of people leaving in cycle 5 as compared to other cycles suggesting that either 
  + a) alot of people joined in cycle 5 than compared to the other years
  + b) Somthing caused alot of people to leave this year than compared to the other years
  
### Reason for leaving
As we can see the reason why people leave the course we can try to find the main reason for people leaving. 

```{r The_reason_given_to_why_people_left}

Reason_Count

```

Looking at all the results put together we see that the majority of the user left as they don't have enough time or for another unknown reason (other). We see that there is a few more people saying that they left because the course was too difficult than there is saying the course is too easy, this suggest that one the whole people seem to find the course hardier than easier. 

We also see that there inst any NA values suggesting that the data is complete and every row containes a reason for leaving.


#### last_completed_step 
The last completed step tells us how far a user made it through the course. I expect that the majortity of the peole leave at the start.

```{r last_completed_step}

table(combine_Leaving_NoDups$last_completed_step, useNA="always")

```
We see that there are 32 individual steps though out the database. Looking at the table of results we see that there the is alot of (over 50%) NA values in this data set suggesting that the quality may not be that create. Whilist we see a few people leaving at the start we see an stark increase at step 3.2 which suggest that there is somthing at that week that is causing people to leave.

#### last_completed_week_number
I decide to keep the last week number in as it would be useful to group all of the week steps together so we can record how far a user got through the course by large milestones and not small steps. last_completed_week_number has a lot of different factors so visualizing the results may be difficult.

```{r how_many_people_left}

table(combine_Leaving_NoDups$last_completed_week_number, useNA="always")

```
Looking at the table of results we see that there the is alot of (over 50%) NA values in this data set. What is interesting is that there the same amount of NA values that where found in the last_completed_step suggesting that there might be some similarities in these NA values which might be worth looking into to.

Not looking at the NA we see that the first week has alot of people leaving and not that many leaving in the secound week.

#### last_completed_step_number
For the the rest of my analysis i will likely ignore this column as it step number if each week. As we have 3 weeks of content then we will have duplicate step number values for each step so its will be likely that is will cause confusion down the line. The last_completed_step contains the week and step number so it wouldn't have this issue. Because of that I will not need this column.

#### Left at
The last column to check was the leave date. A quick check of this column showed that there was no error and each user had a leaving time.

## Data preparation

### Dataset 
The data set that I will use is the dataset of the combined leavers responses. As we saw in the data exploration we have some issues with the data that I will need to explore and try to fix. The following section the will be exploring this dataset and cleaning it.

#### The NA rows in the last_completed_step and last_completed_week_number
As the last_completed_step and last_completed_week_number are more meant to represent week titles I decided to convert them from doubles to factors so that i could better utilize the data. I also did the same to the column cycle.

When looking the last_completed_step and the last_completed_week_number columns they both contained 204 Na rows. As they both are the same value this suggest that if one column is NA then the other will be NA. 

```{r na_rows}

dim(combine_Leaving_NoDups[rowSums(is.na(combine_Leaving_NoDups)) > 0,])

```

When we get all the rows that conaited NA we have 204. Which tells us if a record has NA for last_completed_step there is also not be a value for last_completed_week_number and last_completed_step_number. As 204 rows is 52% of the data I wanted to think of a reason why this may be the case.

My assumption is that either
- something has wrong with data collection
- These people have left the course before they had done anything on the course so a week value wasnt recorded

If we plot out the reasons why these NA people left we find out that the majority left due to them not having enough time or for other reasons. If these people NA people are infact leaving at the start of the course this results sort of makes sense (they joined the course but discovered they didnt have much time to work on it so they to leave at the start)

```{r Check_Na_leaving_reason_bar}

  Check_Na_leaving_reason_bar

```

## Assumption two
All NA values in the last_completed_step and last_completed_week_number column are actually week "zero" (didn't do anything on the course). From now on all NA values will be converted to Zero.


#### The day people left
Another thing i wanted to look was left_at, This is moment in time where a person left there course.

For this i had to do some work on the database. I have changed left_at to a actual time step and then split it onto two new columns Date and time. This was so I could create an upcoming plot that I believe would be useful. The left_at value is very spefic moment in time so to really understand the moments people left we are going to need to split the result into there original cycles (as they leave one after the another).

These are the start dates for each cycle

+ Cycle 4 - 13 Nov 2017
+ Cycle 5 - 5 Feb 2018 
+ Cycle 6 - 11 Jun 2018 
+ Cycle 7 - 10 Sep 2018 

Using this information I plotted the following graph looking at the time at which people left and the week number. I expect that as the weeks in a cycle go on we should see distinict groups week numbers leaving. The Y axis is the hour someone left, This was done to help avoid overlaps of points (dosnt add anything to the graph)

```{r timeline_full}

  timeline_full

```

When adding a line of each of the course start dates we see that there seems to be alot of people dropping out at the start of each cycle.
We also see that that in cycle 6 and 7 there where a few people that dropped out before the course began. 

What is odd is that in cycle 6 is that there is a person who has apparently completed week 3 before the course even began which is odd.
In cycle 7 we see that there was one person who apparently got to week 2 and then left a day or two after the course began.

#### Whats going on with the person who left at week 3 before the course even started

In cycle 6 we see someone left at week 3 before the course even started. How is this possible?

We see that there was `r dim(before_course)` people who left the course before it had stared. All these people didn't complete a week par the one person that finished week 3.

We see this person is user 353eaf1b-cff8-4d9c-98d4-b9a736c17e73 who left the course on the 2018-05-09 03:54:35 however there last step is was done on the 2018-07-15 16:53:37 which is 2 months after they left. This should be possible. This user only has one record in this data so an error has occurred in the recording of this data. 

This has lead me to thinking that there may be more error like this so I will need to do a check for more of these "impossible" leavers 

#### "impossible" leavers 

In the whole dataset there seems to be 8 users who left the course but still where able to complete a set after they left. As this is 8 user spread over the 4 cycles I will remove these error in order to keep the data tidy and bit less error free.

```{r impossible}

dim(impos_leaver)

```
#### Reason for leaving per cycle.

With the data cleaned a bit more I decided that I will look into the. The reason why people left each cycle. As we saw previously alot of the leavers who left a response happened in cycle 5. I wanted to figure out if there was a reason for this or if this cycle followed the trends of the other ones. 

```{r Reason_Count_cycle}
Reason_Count_cycle
```

If we split the results into the cycle they where achieved from we see that in cycle 6 and 7 the majority of people left because they didn't have time.
We also see that in cycle 5 the dominate reason was for some unknown (other). This is the cycle that had the most drop outs so this suggest that this cycle contained a 'unique' issues that might of only occurred during this cycle and cause alot of people to leave.

#### Weeks leaving per cycle.

Next I wanted to break down how many people left in each week per cycle. I expect that there be alot of people leaving at the start of the course but that it would decrease as the weeks went on.

```{r Leavers_perweek_percycle}
Leavers_perweek_percycle
```

Looking at the graph we see that for all cycles, a large majority of people left without starting the course. We also see that all cycle follow the same trend 1st week , 3rd week and then the second week. There isnt alot of people that left in the second week suggesting that this week keeps its users quite engaged.

#### Reason for leaving per week.

As we see that throughout each cycle the amount of leavers per week is roughly the same I wanted to see what the primary reasons why people left each week.

When turning the amount of responses into a graph of percentage we see the following.

```{r leaving_reason_lcwn_percenatge}
leaving_reason_lcwn_percenatge
```
For weeks 0,1 and 2 the main leaving reason was that the users didn't have time which makes sense. They are likely to leave the course early if they know they don't have time than try to continue.

Through out all weeks we a similar balance between the number of people leaving because the course is too difficult and the course was too easy suggesting that the course has a good balance. 

We see that the highest percentage "the course wasn't what I expected" occurs in cycle 1 which is what you would expected as people would join the course do a bit for the first week and that then decide that the course isnt what they expect.

We see that an overwhelming majority of people left in week 3 said the reason was other, this suggest there might be something that has happened in week 3 that caused people to leave.


#### Time between leaving 

While most of the people who leave the course don't complete a week there is still 174 people who did leave after at least starting the course.

I wanted to find what the time between the last step that a user completes and when they officially leave the course. I felt that this could be useful as if we know how long it take a user to leave the course after there last step ,something could be done to prevent it. 

For this a new sub table was created that works out the time in minuets between the users last step and the users leaving data. Also for simplicity I grouped the minuets into groups of how many days had passed between the two events.

When working out the times between the two events but rounded down to number days that passed we see the following.

```{r days_passed_summary}
summary(as.numeric(time_between$days_passed))
```

We see the median number of days that had passed was 5. This means that that half the people leave the course within one working week of completing there last step. What is alarming is that 25% of the people leave within the 24 hours of completing there last cycle step. Suggesting that most of the time the user dosnt need much time to think about leaviing they finish the last step and then idmedantly think about leaving.

Visually representing this as a histogram show us the following.

```{r Histogram_Leave_time}
Histogram_Leave_time 
```

We can see that most of the the people leave within 24 hours for them completing there last step. This backs up the idead that when a user wanst to leave they are most likely do this after finishing a step. Looking a the reasons why. we see

```{r reason_Leave_time}
Leave_time_reason 
```
There is alot of people who left who didn't give a spec reason (other / I prefer not to say). We see that there is a few people. We see that there is a high amount of people that left because that the felt that the course didn't help them or that it wouldn't help them achieve there goal. I somewhat expected this to be high as if a person didn't think that the course would help them you wouldn't expect them to stay around for long.

## Why is there an increase in people leaving in week 3

I really wanted to see why people where leaving in the 3rd week. When we did a count of the number of people who left at each step we saw that there was alot of people that left within the first few steps but there also seemed to be alot of people leaving at step 3.2. This happened in all cycles.

Looking at the courses step 3.2 is a video (Devices in the future home VIDEO (03:26)).

However what should also be mentioned is that the final step is 3.20, so there is a possibility that there has been some error in recording the data (people who finished the course are accidentally put down as leaving).


```{r reason_Leave_32}
Reason_Step_32 
```
Looking at the reason given we see that the reason is overwhelimily "other". This suggest that there is a really unique issue with this video that is causing people to leave. Maybe its offending people? This is probably 

## Evaluation 

### What I found

After cleaning up my data set and getting a grips with it I decide that I wanted to Evaluate what I had found and how it could be helpful in answering my business question into "give useful insights into why people decide to leave the course". 

+ I have broken down alot of the timings when people leave and the most common given reason. For the most part it is either that the user dosn't have time or that they dont want to say.
+ We see that there is in nearly all situation where we look at the response The amount of people saying the course was too easy or too hard was roughly the same suggesting that the difficulty isn't too much of an issue.
+ The majority (around 52%) of the people that leave don't even complete a week, suggesting that people 
+ If a person is going to leave they are likely to do it within a day of finishing within the day.
+ For some unknown reason alot of people leave at step 3.2 which suggests that the video may be offending people / causing them to leave.  

### Review process

I found a fair bit that I could use to answer my business question in regards to why people leave at but only at what times. However we don't really know who the people are leaving are. If we could get information about who was leaving and why then more measures could be put in place to keep user from leaving the course. This gave me the idea to do another cycle to try and look into this.



