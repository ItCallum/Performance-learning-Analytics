---
title: "Who_is_leaving"
author: "Callum Simpson"
date: "29/11/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
# Knitr setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
```


```{r include=FALSE}
# Load project

library('ProjectTemplate')
load.project()

source("src/SC_for_clean_enroled.R")

```


## How many people didnt leave the course 

We see that there are 1279 cases of people with unenrolled_at dates.

```{r cars}

How_many_unerolled
  
```


## Why so many Unenrolled when compared to the users that are 

We see that the enrolled data had over 1,279 rows with an unenrolled_at date.

However there was 380 records of users leavers reports. 

In previous analysis we see that the most the user leaver reports where in the 5th cycle. This would suggest that most of the people that left would be in cycle 5. However this isn't the case as we can see the majority of people with unenrolment dates are in the 4th cycle.  

I wanted to visually compared the two set of leaving data, the enrolled data with an unenrolled_at date and the leavers response data set to see what they would look like against one another. We find something interesting with by doing this. What we see is that there as the cycles go on there is alot less people leaving so the difference between the amount of unrolled_at and leavers response becomes smaller. What we also see is that alot of cycles have people unrolling surprisingly late after the course (for example there are people in the 4th cycle that unenrolled in the 7th cycle)

```{r cars}

Unenrolled_combined <- combine_Enrolments[!(is.na(combine_Enrolments$unenrolled_at) | combine_Enrolments$unenrolled_at==""), ]

table(Unenrolled_combined$role)

table(Unenrolled_combined$Cycle)

Unenrolled_combined

timeline_full_Unenrolled
```
## Did anyone enrole after they left

No

```{r pressure, echo=FALSE}

merged_data %>% filter(left_at < enrolled_at)

```


## Anything fishy with the enrollment data?

As we saw with the Visual comparison of unrolled data vs leaver response along a time line we see that there is a lot of people unenrolling months after there course had ended. I thought (though unlikely) that this may be an error in the data being recorded (i.e people are being recorded in one cycles database when they actually attended another cycle). I decided to check when people enrolled for a course. If people had enrolled way after that cycle ended then there had obviously had been some issues. 

Looking at the time scale of enrollment dates we see this doesn't hold, there is no instance where a person enroles for a course after it had finished. What is weird is that there does seem to be some overlap in enrollment times. For example there are people who enroll just before cycle 4 ended and at the same time there are people who are enrolling for cycle 5. This may mean that a user can apply for course whenever they want to and then have as long as they want to complete it.

```{r pressure, echo=FALSE}

timeline_full_enrolled

```

Assumption As we see in the date set we have people that have people with an unenrollment date and those who havnt. Based on this I am going to assume the following. People without any data are still working on the material or have just left it without formally leaving (they just logged off one day and havnt come back). This means that i will assume that the unenrollment date is for both those who have left the course and those who have completed the course.


## merged_data

For my set set on analysis i wanted to add in the users Enrollments data to in order to find out more information about the people that left.

The new data included is 

- Gender
- Enrolled time 
- role
- age range
- highest_education_level
- employment_status
- employment_area
- detected_country

```{r pressure, echo=FALSE}
## merged_data
```

## About the users 1

Looking at the columns gender, Country and age range we see that the majority of these columns are dominated by Unknown data. This mat be cause by the users not wanting to enter any personal data about themselves or some issue when collecting the data. 

We can see that not all the Unknowns are the same size so this tells us that it might not be an error in collecting data as you would expect that all data the same rows would be unknown and not diffrent sizes. This suggest that there is a fair few users that are not wanting to give information  

```{r pressure, echo=FALSE}

table(merged_data$gender)

table(merged_data$country)

table(merged_data$age_range)

table(merged_data$role)

```

##Detected country

There is two columns that both contain country data, country which i'm guessing what the user entered and detected_country which is probably and automatic check that has been run without the user knowing and recorded.

Doing a table we see that there is alot more of a variety in the data detected_country than country (as there inst any unknown values).

Doing a check of all known counties vs the results of detected_country we see that there is 108 similarities and 8 Differences.

Looking at the rows that returned false we see that there is 4 rows with no detected_country. Suggesting that these users are using a VPN of some description.

Due to the fact we have alot of unkowns in country i will use detected_country to say where a user is from.


```{r pressure, echo=FALSE}

table(merged_data$country)

table(merged_data$detected_country)

df_same_country_count

diffrent_country_results

```

## About the users 2

After looking at the area of user 

- role
- highest_education_level
- employment_status
- employment_area

Looking at these variables we see that there is a large amount of unknowns in each columns. I think this is primalry due to users dont wanting to say what they do, maybe there is inst the option to exactly state what the user does/is.

```{r pressure, echo=FALSE}

table(merged_data$role)

table(merged_data$highest_education_level)

table(merged_data$employment_status)

table(merged_data$employment_area)
```

## Two leaving dates.

Looking at the unenrolled_at time we see that there is 5 records that dont have an unenrolled_at time but do have a left_at time. We see near all of these happen in the 3rd week. This is somthing that I am going to have to look at 

As the enrollment data had its own recording of when a user left i decided to look at if this matched the left_at time in the leaving data.

We see out of all the leaver there was 8 miss matches. 5 of these where only a second out so this really inst a problem. 

The three other records where out by more than a month. I am unsure what i should do with these 3 values as i am unsure what caused this. I feel like I will keep them in, I'm assuming that the left at time is correct time and the unenrolled at is the time at which they where formally removed from the course. I.e a user leaves the course, it gets recorded 2 times but the time recorded in unenrolled_at didn't get added? This would somewhat explain why there is NA values.

At first I thought that there might be duplicates user entries in the enrollment data per cycle

```{r pressure, echo=FALSE}

has_NA 

## diffrent_leaving_times <-merged_data %>% filter(left_at != unenrolled_at) %>% select(left_at , unenrolled_at, Cycle, last_completed_week_number)

```

##IS there duplicates in the enrole data

This error of the users having two different leaving dates was weird so I wanted to see if it is because we have duplicate user entries in the same cycle. If we merged the data then it may be possible that it got the wrong users enrollment data if there was two different entries for the same user. 

Doing a duplicate check we see that there are infarct 114 occurance of duplicate users but a later check shows that these where all across sperate cycles so the assumption of duplicate enrolment data in the same cycle dosnt hold.

```{r Duplicates_In_enrole, echo=FALSE}

 dup_userid_enrollement 
 
 same_cycle_dupliacted_enrollement 

```


## Cleaned data

After running these check I am going to say that the data has been cleaned and is ready for some more analysis.