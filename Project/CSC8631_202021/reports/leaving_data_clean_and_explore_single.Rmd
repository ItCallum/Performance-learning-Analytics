---
title: "Why_do_people_drop_out"
author: "Callum Simpson"
date: "21/11/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
# Knitr setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
```


```{r include=FALSE}
# Load project

library("ProjectTemplate")
load.project()

source("src/SC_for_clean_leaving_data.R")

```

## Business understanding

The data given is from Future Learn about data they have retrieved about there course over a number of cycles. I am going to look over the data to find an interesting aspect of the data and try and find a reason for it. 



## data_check

The following is me checking over my data. I have combined all the data relating to the reasons why people left.

I wanted to check the quality of the data as I by the looks of it thr recording why people left only occured during cycle 4 which suggest that it was a system added halfway through the process.

As I have merged all the data into one set I have added in a new coloum called cycle which is the number of the cycle the data relates to.

There are 403 rows and 9 variable columns 

```{r data_check}

dim(combine_Leaving)

combine_Leaving

time_between

```

## ID variables 

As 2 of our variables are relating an id I wanted to check to make sure that our dataset didn't contain any duplicates.

We see that id has no duplicates but learner_id did contain some duplicate ids.

From a check for duplicates we find that for the most part are the same learner id but in a different cycle suggesting that we have a few people who are leaving in one cycle but rejoining another cycle only to leave again. 

If we look at duplaices of learner_id and cycle we find 15 occurrences. For the most part we find alot of these duplicates are within a few minuets of each other.

To be safe I decided to remove all these duplicate values

```{r ID_Var_dups}

table_dup_ID

table_dup_Learner_ID

dup_learner_id_and_cycle

dim(removed_duplicate_df)
```

## how_many_people_left 

Next I wanted to see how many people left each cycle 

As we can see there was almost double the amount of people leaving in cycle 5 as compared to other cycles

```{r how_many_people_left}

bar_chart_of_user_per_cycle

```
## Reason for leaving

As we can see the reason why people leave the course we can try to find the main reason for people leaving. 

The majority of the people leaving have left as they don't have enough time or for another unknown reason (other). There dost seem to be alot of people leaving because the course was too easy 

If we split the results into the cycle they where achieved from we see that in cycle 6 and 7 the majority of people left because they didn't have time
We also see that in cycle 5 the dominate reason was for some unkown issue. This is the cycle that had the most drop outs so this suggest that this cycle contained a 'unique' issues that might of only occurred during this cycle and cause alot of people to leave.

```{r The_reason_given_to_why_people_left}


reasons_precenatge_df

Reason_Prectange

Reason_Count

Reason_Count_cycle

```

## Did anyone have a last completed week less than there last complteded step.

No

```{r any_werid_cross overs}

Anyone_comp_week_less_than_last_step

```


## why some many NA

It's quite clear that there is a alot of NA values in the last_completed_step , last_completed_week_number, last_completed_step_number but I wanted to find out why and if there is any correlation.

After replacing NA with zero we can get a count of each row we find that there is an equal amount of rows with NA rows (204).

After turning plotting the bar chart of last_completed_week_number I discovered that overlewaling these "NA"s values made up the most of the results for each cyle.
We also see that most people leave at the start or the end, not in middle (week 2)

When looking the last step people completed before people left we see that the majority of people left before they complete a step. However we can also see that there for all cycles there is a spike in the number of people leaving at step 3.2

It would be interesting to find out the reason why these people left at this step (look at the reason given)

```{r how_many_people_left}

Na_row_precenatage 

print("--last_completed_week_number--")
lcw_table

Leavers_perweek_percycle

print("--last_completed_step--")
lsc_table

no_zero_lcs_bar

no_zero_lcs_bar_cycle
``` 

## The NA rows, the last_completed_step , last_completed_week_number, last_completed_step_numbe

When looking the last_completed_step , last_completed_week_number, last_completed_step_number rows which have NA values we found that they all contained 204 Na rows.
When we get all the rows that conaited NA we have 204. Which tells us if a record has NA for last_completed_step there will also not be a value for last_completed_week_number and last_completed_step_number. This is 52% of the data.

We also see that for each of these rows we have last_completed_step_at has no value

This suggests that 
- Either something has wrong with data collection
- These people have left the course before they had done anything on the course 

If we plot out the reasons why these NA people left we find out that the majority left due to them not having enough time or for other reasons. If these people NA people are infact leaving at the start of the course this results sort of makes sense (they joined the course but discovered they didnt have much time to work on it so they to leave at the start)

```{r how_many_people_left}

Check_Na <- combine_Leaving_NoDups[rowSums(is.na(combine_Leaving_NoDups)) > 0,]

Check_Na

NA_Leaving_reason

Check_Na_leaving_reason_bar

```

## The day people left

The last column we should look at is the left_at. This is moment in time where a person left there course.

For this i had to do some work on the database (now called combine_Leaving_clean). I have changed left_at to a actual time step and then split it onto two new columns Date and time. This was so I could create an upcoming plot that I believe would be useful. I also turned last_completed_step,last_completed_week_number
,last_completed_step_number and Cycle.

The left_at value is very spefic moment in time. Also to really understand the moments people left we are going to need to split the result into there original cycles (as they leave one after the another) 

When all the leavers are all plotted we clearly see that there is alot of spread of last completed step within each cycle. My previous hypthosies was that there would be alot of people leaving at the start but it seems fairly spread out. There are people that are leaving near the end that havnt completed a week.

It would be interesting if we could get the course start dates. That is something that I would need to find.

I found the course timing

Cycle 4 - 13 Nov 2017
Cycle 5 - 5 Feb 2018 
Cycle 6 - 11 Jun 2018 
Cycle 7 - 10 Sep 2018 

When adding a line of each of the course start dates we see that there seems to be alot of people dropping out at the start of each cycle .
We also see that that in cycle 6 and 7 there where a few people that dropped out before the coruse began. 

What is odd is that in cycle 6 is that there is a person who has apparently completed week 3 before the course even began which is odd.
In cycle 7 we see that there was one person who apprently got to week 2 and then left a day or two after the course began.
```{r left_at_time}

timeline_Cycle_4 
timeline_Cycle_5 
timeline_Cycle_6 
timeline_Cycle_7 


timeline_full

```
## Whats going on with the person who left at week 3 before the course even started

In cycle 6 we see someone left at week 3 before the course even started. How?

We see this person is user 353eaf1b-cff8-4d9c-98d4-b9a736c17e73 who left the course on the 2018-05-09 03:54:35 however there last step is was done on the 2018-07-15 16:53:37 which is 2 months after they left. This should be possible. This user only has one record in this data so an error has occured in the recording this value. 

This has lead me to thinking that there may be more error like this so I will need to do a check for more of these "impossible" leavers 

```{r left_at_time}

before_course 

one_person 

```

## "impossible" leavers 

In the whole dataset there seems to be 8 users who left the course but still where able to complete a set after they left. As this is 8 user spread over the 4 cycles I will remove these error in order to keep the data tidy and bit less error free.

```{r left_at_time}

impos_leaver

```

